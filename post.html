<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post - Từ Minh Đức</title>
    <link rel="icon" type="image/png" href="images/logo/favicon.png"> 
    
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous" 
        src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v18.0" 
        nonce="Avx8j3s1">
    </script>

    <div class="container">
        <header>
            <div class="logo"><img src="images/logo/logo.png" alt="Logo" class="logo-img"><span>Từ Minh Đức</span></div>
            <nav>
                <ul><li><a href="blog.html"><span class="hash"><</span> back-to-blog</a></li></ul>
            </nav>
        </header>

        <article class="post-container">
            <div class="post-hero">
                <img id="post-image" src="" alt="Hero Image">
            </div>

            <div class="post-header">
                <div class="post-info">
                    <span id="post-category" class="post-badge">Category</span>
                    <span id="post-date" class="post-meta">Date</span>
                </div>
                <h1 id="post-title" class="font-text">Loading...</h1>
            </div>
            
            <div class="post-divider"></div>

            <div id="post-content" class="post-body font-text">
            </div>

            <div class="comment-section">
                <h3 style="margin-top: 40px; margin-bottom: 20px; font-family: 'Inter', sans-serif; color: var(--white);">
                    Bình luận
                </h3>
                <div class="fb-comments" 
                     data-href="" 
                     data-width="100%" 
                     data-numposts="5"
                     data-colorscheme="dark">
                </div>
            </div>
        </article>

        <section class="related-section">
            <h3 class="related-title">Bài viết liên quan</h3>
            <div id="related-list" class="related-grid">
            </div>
        </section>

        <footer>
            <div class="copyright">© Copyright 2025. Made by Đức</div>
        </footer>
    </div>

    <script src="blog-data.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('id');
        const post = blogPosts.find(p => p.id === postId);

        if (post) {
            // Load nội dung bài hiện tại
            document.title = post.title + " - Duc's Blog";
            document.getElementById('post-image').src = post.image;
            document.getElementById('post-title').innerText = post.title;
            document.getElementById('post-date').innerText = post.date;
            document.getElementById('post-category').innerText = post.category.toUpperCase();
            document.getElementById('post-content').innerHTML = post.content;

            // --- 3. CẤU HÌNH FACEBOOK COMMENT (TỰ ĐỘNG CẬP NHẬT LINK) ---
            const fbCommentBox = document.querySelector('.fb-comments');
            if (fbCommentBox) {
                // Gán link hiện tại của trình duyệt vào data-href
                fbCommentBox.setAttribute('data-href', window.location.href);
                
                // Bắt Facebook tải lại khung comment
                if (window.FB) {
                    FB.XFBML.parse();
                }
            }
            // -------------------------------------------------------------

            // --- XỬ LÝ BÀI LIÊN QUAN (RELATED POSTS) ---
            const relatedContainer = document.getElementById('related-list');
            
            // Lọc các bài cùng category nhưng KHÔNG trùng bài hiện tại
            const relatedPosts = blogPosts
                .filter(p => p.category === post.category && p.id !== post.id)
                .slice(0, 3); // Chỉ lấy tối đa 3 bài

            if (relatedPosts.length > 0) {
                relatedPosts.forEach(rp => {
                    const rCard = document.createElement('div');
                    rCard.className = 'related-card';
                    rCard.innerHTML = `
                        <a href="post.html?id=${rp.id}" class="related-thumb">
                            <img src="${rp.image}" alt="${rp.title}">
                        </a>
                        <div class="related-content">
                            <h4><a href="post.html?id=${rp.id}" class="font-text">${rp.title}</a></h4>
                            <span class="related-date">${rp.date}</span>
                        </div>
                    `;
                    relatedContainer.appendChild(rCard);
                });
            } else {
                relatedContainer.innerHTML = '<p style="color:var(--gray)">Không có bài viết liên quan.</p>';
            }

        } else {
            document.getElementById('post-content').innerHTML = "<h1>404</h1><p>Bài viết không tồn tại.</p>";
            document.getElementById('post-image').style.display = 'none';
        }
    </script>
    
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        var canvas = document.createElement("canvas");
        canvas.style.position = "fixed";
        canvas.style.top = "0";
        canvas.style.left = "0";
        canvas.style.width = "100%";
        canvas.style.height = "100%";
        canvas.style.pointerEvents = "none";
        canvas.style.zIndex = "9999";
        document.body.appendChild(canvas);

        var ctx = canvas.getContext("2d");
        var width = window.innerWidth;
        var height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;

        var maxFlakes = 100;
        var flakes = [];

        for (var i = 0; i < maxFlakes; i++) {
            flakes.push({
                x: Math.random() * width,
                y: Math.random() * height,
                r: Math.random() * 2 + 1,
                d: Math.random() + 1
            });
        }

        function drawFlakes() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
            ctx.beginPath();
            
            for (var i = 0; i < maxFlakes; i++) {
                var f = flakes[i];
                ctx.moveTo(f.x, f.y);
                ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2, true);
            }
            ctx.fill();
            moveFlakes();
        }

        var angle = 0;
        function moveFlakes() {
            angle += 0.01;
            for (var i = 0; i < maxFlakes; i++) {
                var f = flakes[i];
                f.y += Math.pow(f.d, 2) + 1;
                f.x += Math.sin(angle) * 2;

                if (f.y > height) {
                    flakes[i] = {
                        x: Math.random() * width,
                        y: 0,
                        r: f.r,
                        d: f.d
                    };
                }
            }
        }

        setInterval(drawFlakes, 25);

        window.onresize = function() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }
    });
    </script>
</body>
</html>